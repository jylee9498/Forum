<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="/main.css" rel="stylesheet">
</head>
<body class ="grey-bg">

    <%- include("nav.ejs") %>

    <div class="white-bg">
        <% for (let i = 0; i < posts.length; i++){ %>
        <div class="list-box">
            <%= JSON.stringify(posts[i]._id) %>
            <h4>
                <a href = "/detail/<%= posts[i]._id%>">
                    <%= posts[i].title%> 
                </a>
                <a href = "/edit/<%= posts[i]._id%>">✏️ </a>
                <span class ="delete" data-id="<%= posts[i]._id %>">🗑️</span>
            </h4>
            <p><%= posts[i].content%></p>
        </div>
        <%} %>
    </div>
    <script>
        // document.querySelectorAll(".delete")[0].addEventListener("click", function(){
        //     fetch("/delete", {         // fetch를 사용하면 ajax이용하는 것.(?) fetch("url")은 새로고침 없이도 GET요청함.
        //         method : "DELETE",    // method에 Post를 사용하면 새로고침 없어도 Post 요청
        //         headers : {
        //             "Content-Type" : "application/json"
        //         },
        //         body : JSON.stringify({
        //             a:1
        //         })// object나 array를 문자열로 바꿔주는 함수
        //     }); 
        // });

        // /* 서버로 전송할 때 다른 방법 */
        // /*
        //     fetch("/abc/홍길동")
        //     : url로 데이터 전송, 서버에서는 req.params로 데이터 획득 가능

        //     fetch("/abc?age=20&name=홍길동")
        //     : url로 데이터 전송, 서버에서는 req.query로 데이터 획득 가능
        //  */
        document.querySelectorAll('.delete')[0].addEventListener('click', function(e){
            fetch('/delete?docid=' + e.target.dataset.id, {
                method:"DELETE"
            });
        });

        document.querySelectorAll('.delete')[1].addEventListener('click', function(e){
            fetch('/delete?docid=' + e.target.dataset.id, {
                method:"DELETE"
            });
        });

        document.querySelectorAll('.delete')[2].addEventListener('click', function(e){
            console.log(e.target.dateset._id)
            fetch('/delete?docid=' + e.target.dataset.id, {
                method:"DELETE"
            });
        });
        
    </script>
</body>
</html>